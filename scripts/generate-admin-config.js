const fs = require('fs');
const path = require('path');

const targetPath = path.join(__dirname, 'admin-config.js');

function resolvePassword() {
  const raw = process.env.ADMIN_PASSWORD;
  if (typeof raw === 'string' && raw.trim()) {
    return raw.trim();
  }
  if (typeof raw === 'number') {
    return String(raw);
  }
  return null;
}

function writeConfig(password) {
  const banner = '/** Auto-generated by generate-admin-config.js **/';
  const serialized = password === null ? 'null' : JSON.stringify(password);
  const contents = `${banner}\nwindow.ADMIN_PASSWORD = ${serialized};\n`;
  fs.writeFileSync(targetPath, contents, { encoding: 'utf8' });
}

function main() {
  const password = resolvePassword();
  writeConfig(password);
  if (password) {
    console.log('Admin password configuration written to scripts/admin-config.js');
  } else {
    console.warn('ADMIN_PASSWORD environment variable is not set. Admin login will remain disabled.');
  }
}

if (require.main === module) {
  main();
}
