const fs = require('fs');
const path = require('path');

const DEFAULT_PASSWORD = 'test-admin';
const targetPath = path.join(__dirname, 'admin-config.js');

function resolvePassword() {
  const raw = process.env.ADMIN_PASSWORD;
  if (typeof raw === 'string' && raw.trim()) {
    return raw.trim();
  }
  if (typeof raw === 'number') {
    return String(raw);
  }
  return DEFAULT_PASSWORD;
}

function writeConfig(password) {
  const banner = '/** Auto-generated by generate-admin-config.js **/';
  const contents = `${banner}\nwindow.ADMIN_PASSWORD = ${JSON.stringify(password)};\n`;
  fs.writeFileSync(targetPath, contents, { encoding: 'utf8' });
}

function main() {
  const password = resolvePassword();
  writeConfig(password);
  if (password === DEFAULT_PASSWORD) {
    console.warn('ADMIN_PASSWORD environment variable is not set. Using default "test-admin".');
  } else {
    console.log('Admin password configuration written to scripts/admin-config.js');
  }
}

if (require.main === module) {
  main();
}
